<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>MV STUDIO PRO - REBORN 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>
    <style>
        :root { --main: #ffffff; } 
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; background: #000; overflow: hidden; color: white; font-family: sans-serif; }
        #viewport { position: relative; width: 100%; height: calc(100% - 220px); background: #111; overflow: hidden; }
        #viewport:fullscreen { height: 100vh; }
        
        #bg-v, #bg-i, #bg-s { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: none; z-index: 1; }
        #cam-box { position: absolute; z-index: 10; cursor: move; display: none; top: 20px; right: 20px; border: 1px solid rgba(255,255,255,0.2); }
        #ai-canvas { width: 450px; }
        #circle-box { position: absolute; z-index: 15; cursor: move; width: 300px; height: 300px; display: flex; align-items: center; justify-content: center; top: 10%; left: 30%; }
        #radial-canvas { position: absolute; z-index: 16; pointer-events: none; }
        #inner-circle { width: 120px; height: 120px; border-radius: 50%; border: 3px solid #fff; background: #000; overflow: hidden; z-index: 17; display: flex; align-items: center; justify-content: center; }
        #inner-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        #branding { position: absolute; z-index: 20; cursor: move; font-weight: 900; text-transform: uppercase; text-shadow: 2px 2px 15px #000; bottom: 80px; left: 40px; font-size: 50px; color: white; }

        /* Panou Control cu 6 coloane */
        #controls { position: absolute; bottom: 0; width: 100%; height: 220px; background: #0a0a0a; display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; padding: 10px; border-top: 2px solid #333; }
        .panel { background: #141414; padding: 8px; border-radius: 6px; border: 1px solid #222; display: flex; flex-direction: column; justify-content: space-between; }
        .panel h3 { font-size: 9px; color: #ffaa00; text-align: center; font-weight: 800; border-bottom: 1px solid #333; margin-bottom: 6px; padding-bottom: 3px; text-transform: uppercase; }
        
        .btn { width: 100%; padding: 7px; font-weight: bold; border-radius: 4px; text-transform: uppercase; font-size: 9px; cursor: pointer; border: none; }
        .st-off { background: #331111; color: #ff4444; border: 1px solid #552222; }
        .st-on { background: #113311; color: #44ff44; border: 1px solid #225522; }
        .btn-blue { background: #1e40af; color: white; }
        .btn-upload { background: #222; color: #aaa; font-size: 8px; border: 1px dashed #444; }

        label { font-size: 8px; color: #555; font-weight: bold; margin-top: 2px; text-transform: uppercase; }
        input[type="range"] { width: 100%; accent-color: #ffaa00; }
        input[type="text"] { background: #000; color: #fff; border: 1px solid #333; font-size: 10px; padding: 4px; }
    </style>
</head>
<body>

<div id="viewport">
    <video id="bg-v" autoplay loop muted></video>
    <img id="bg-i">
    <img id="bg-s">
    <div id="cam-box"><canvas id="ai-canvas"></canvas></div>
    <video id="v-hidden" autoplay playsinline style="display:none"></video>
    <div id="circle-box">
        <canvas id="radial-canvas" width="400" height="400"></canvas>
        <div id="inner-circle"><img id="inner-img"></div>
    </div>
    <div id="branding">STUDIO MV</div>
</div>

<div id="controls">
    <div class="panel">
        <h3>1. FUNDAL VIDEO</h3>
        <button id="btn-v" class="btn st-off" onclick="tgL('bg-v', 'btn-v')">VIDEO: OFF</button>
        <input type="file" id="up-v" class="hidden" accept="video/*" onchange="loadMedia(this, 'bg-v', 'btn-v')">
        <button class="btn btn-upload" onclick="document.getElementById('up-v').click()">üìÅ √éNCARCƒÇ VIDEO</button>
    </div>

    <div class="panel">
        <h3>2. FUNDAL FOTO</h3>
        <button id="btn-i" class="btn st-off" onclick="tgL('bg-i', 'btn-i')">FOTO: OFF</button>
        <input type="file" id="up-i" class="hidden" accept="image/*" onchange="loadMedia(this, 'bg-i', 'btn-i')">
        <button class="btn btn-upload" onclick="document.getElementById('up-i').click()">üñºÔ∏è √éNCARCƒÇ FOTO</button>
    </div>

    <div class="panel">
        <h3>3. SLIDESHOW</h3>
        <button id="btn-s" class="btn st-off" onclick="tgL('bg-s', 'btn-s')">SLIDESHOW: OFF</button>
        <label>VitezƒÉ (sec):</label>
        <input type="range" min="1" max="10" value="3" id="s-spd">
        <input type="file" id="up-sld" class="hidden" webkitdirectory directory multiple onchange="loadFolder(this)">
        <button class="btn btn-upload" onclick="document.getElementById('up-sld').click()">üìÇ ALEGE FOLDER</button>
    </div>

    <div class="panel">
        <h3>4. CAMERA (AI)</h3>
        <button class="btn btn-blue mb-1" onclick="startAI()">PORNE»òTE</button>
        <button id="btn-cam" class="btn st-off" onclick="tgC()">AFI»òEAZƒÇ: OFF</button>
        <label>MƒÉrime:</label><input type="range" min="200" max="800" value="450" oninput="document.getElementById('ai-canvas').style.width=this.value+'px'">
        <label>Opacitate:</label><input type="range" min="0.1" max="1" step="0.1" value="1" oninput="document.getElementById('cam-box').style.opacity=this.value">
    </div>

    <div class="panel">
        <h3>5. VUMETRU LOGO</h3>
        <button id="btn-png" class="btn st-off" onclick="tgP()">AFI»òEAZƒÇ LOGO: OFF</button>
        <input type="file" id="up-logo" class="hidden" onchange="loadLogo(this)">
        <button class="btn btn-upload" onclick="document.getElementById('up-logo').click()">‚¨ÜÔ∏è URCARE LOGO PNG</button>
        <label>MƒÉrime Cerc:</label><input type="range" min="0.5" max="2" step="0.1" value="1" oninput="document.getElementById('circle-box').style.transform=`scale(${this.value})` ">
        <label>Sensibilitate:</label><input type="range" min="1" max="20" value="10" id="v-sens">
    </div>

    <div class="panel">
        <h3>6. SISTEM & TEXT</h3>
        <input type="text" placeholder="TEXT BRANDING..." oninput="document.getElementById('branding').innerText=this.value">
        <label>MƒÉrime Text:</label><input type="range" min="20" max="150" value="50" oninput="document.getElementById('branding').style.fontSize=this.value+'px'">
        <button class="btn btn-blue mt-2" onclick="goFS()">FULL SCREEN</button>
    </div>
</div>

<script>
    const app = firebase.initializeApp({ databaseURL: "https://felicitari-nunta-default-rtdb.firebaseio.com" });
    const dbRemote = app.database().ref('remote_control_cioko');
    const startupTime = Date.now();
    let sFiles=[], sIdx=0, sTim;

    // REMOTE
    dbRemote.on('value', (snap) => {
        const data = snap.val(); if(!data) return;
        if(data.text) document.getElementById('branding').innerText = data.text;
        if(data.time > startupTime && data.media_type) {
            const bId = data.media_type === 'bg-v' ? 'btn-v' : (data.media_type === 'bg-i' ? 'btn-i' : 'btn-s');
            tgL(data.media_type, bId);
        }
        if(data.time > startupTime && data.cmd === 'FULLSCREEN') goFS();
    });

    // MEDIA FUNCTIONS
    function loadMedia(input, targetId, btnId) {
        const file = input.files[0]; if(!file) return;
        const url = URL.createObjectURL(file);
        const el = document.getElementById(targetId);
        if(targetId === 'bg-v') { el.src = url; el.play(); } else { el.src = url; }
        tgL(targetId, btnId);
    }

    function loadFolder(input) {
        sFiles = Array.from(input.files).filter(f => f.type.startsWith('image/')).map(f => URL.createObjectURL(f));
        if(sFiles.length > 0) tgL('bg-s', 'btn-s');
    }

    function tgL(id, bId) {
        document.querySelectorAll('#bg-v,#bg-i,#bg-s').forEach(e => e.style.display='none');
        document.querySelectorAll('#btn-v,#btn-i,#btn-s').forEach(b => { 
            b.className='btn st-off'; 
            b.innerText = b.innerText.split(':')[0] + ': OFF'; 
        });
        if(sTim) clearTimeout(sTim);
        document.getElementById(id).style.display = 'block';
        const btn = document.getElementById(bId);
        btn.className = 'btn st-on';
        btn.innerText = btn.innerText.split(':')[0] + ': ON';
        if(id === 'bg-s') startSlides();
    }

    function startSlides() {
        if(!sFiles.length) return;
        document.getElementById('bg-s').src = sFiles[sIdx];
        sIdx = (sIdx + 1) % sFiles.length;
        sTim = setTimeout(startSlides, document.getElementById('s-spd').value * 1000);
    }

    // LOGO
    function loadLogo(input) {
        const file = input.files[0]; if(!file) return;
        const img = document.getElementById('inner-img');
        img.src = URL.createObjectURL(file);
        img.style.display = 'block';
        const btn = document.getElementById('btn-png');
        btn.className = 'btn st-on';
        btn.innerText = 'AFI»òEAZƒÇ LOGO: ON';
    }

    function tgP() {
        let e = document.getElementById('inner-img'), btn = document.getElementById('btn-png');
        if(e.style.display === 'none') { e.style.display='block'; btn.className='btn st-on'; btn.innerText='AFI»òEAZƒÇ LOGO: ON'; }
        else { e.style.display='none'; btn.className='btn st-off'; btn.innerText='AFI»òEAZƒÇ LOGO: OFF'; }
    }

    // CAMERA AI
    const selfieSegmentation = new SelfieSegmentation({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}` });
    selfieSegmentation.setOptions({ modelSelection: 1 });
    selfieSegmentation.onResults(results => {
        const can = document.getElementById('ai-canvas'), ctx = can.getContext('2d');
        can.width = results.image.width; can.height = results.image.height;
        ctx.save(); ctx.clearRect(0,0,can.width,can.height);
        ctx.drawImage(results.segmentationMask, 0,0,can.width,can.height);
        ctx.globalCompositeOperation = 'source-in';
        ctx.drawImage(results.image, 0,0,can.width,can.height);
        ctx.restore();
    });

    async function startAI() {
        const stream = await navigator.mediaDevices.getUserMedia({video:true, audio:true});
        const v = document.getElementById('v-hidden');
        v.srcObject = stream; v.play();
        const predict = async () => { await selfieSegmentation.send({image: v}); requestAnimationFrame(predict); };
        predict();
        initVumetru(stream);
    }

    function initVumetru(stream) {
        const can = document.getElementById('radial-canvas'), c = can.getContext('2d');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const src = audioCtx.createMediaStreamSource(stream);
        const ans = audioCtx.createAnalyser();
        ans.fftSize = 256; const data = new Uint8Array(ans.frequencyBinCount);
        src.connect(ans);
        function draw() {
            requestAnimationFrame(draw); ans.getByteFrequencyData(data);
            c.clearRect(0,0,400,400);
            let sens = document.getElementById('v-sens').value / 5;
            c.strokeStyle = "#ffffff"; c.lineWidth = 4;
            for(let i=0; i<60; i++){
                let a = (i*6)*Math.PI/180, l = data[i] * 0.4 * sens;
                c.beginPath(); c.moveTo(200+Math.cos(a)*80, 200+Math.sin(a)*80);
                c.lineTo(200+Math.cos(a)*(80+l), 200+Math.sin(a)*(80+l)); c.stroke();
            }
        } draw();
    }

    function tgC() {
        let b = document.getElementById('cam-box'), btn = document.getElementById('btn-cam');
        if(b.style.display === 'block') { b.style.display = 'none'; btn.className = 'btn st-off'; btn.innerText = 'AFI»òEAZƒÇ: OFF'; }
        else { b.style.display = 'block'; btn.className = 'btn st-on'; btn.innerText = 'AFI»òEAZƒÇ: ON'; }
    }

    function goFS() { 
        let v = document.getElementById('viewport');
        if(v.requestFullscreen) v.requestFullscreen(); else if(v.webkitRequestFullscreen) v.webkitRequestFullscreen();
    }

    // DRAG
    function drag(e) {
        let p1=0, p2=0, p3=0, p4=0;
        e.onmousedown = (m) => {
            if(m.target.tagName === 'INPUT' || m.target.tagName === 'BUTTON') return;
            p3=m.clientX; p4=m.clientY;
            document.onmouseup = () => { document.onmouseup=null; document.onmousemove=null; };
            document.onmousemove = (m) => {
                p1=p3-m.clientX; p2=p4-m.clientY; p3=m.clientX; p4=m.clientY;
                e.style.top=(e.offsetTop-p2)+"px"; e.style.left=(e.offsetLeft-p1)+"px";
            };
        };
    }
    [document.getElementById('circle-box'), document.getElementById('cam-box'), document.getElementById('branding')].forEach(drag);
</script>
</body>
</html>
